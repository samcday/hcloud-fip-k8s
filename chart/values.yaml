replicaCount: 1

image:
  repository: samcday/hcloud-fip-k8s
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext:
  allowPrivilegeEscalation: false
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

resources: {}
  # limits:
  #   cpu: '1'
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

env:
- name: HCLOUD_TOKEN
  valueFrom:
    secretKeyRef:
      name: hcloud
      key: token

nodeSelector: {}

tolerations: []

affinity: {}

config:
  cacheNamespace: "{{ .Release.Namespace }}"
  floatingIP:
    # Limit floating IPs to be managed to given label selector. See https://docs.hetzner.cloud/#label-selector
    # selector: role=nat
    # label: node-role.kubernetes.io/nat-gateway
    # setupAnnotation: example.samcday.com/nat-gateway
    selector: role=vip
    label: node-role.kubernetes.io/vip
    setupAnnotation: samcday.com/vip
    setupJob:
      ttlSecondsAfterFinished: 3600
      template:
        spec:
          containers:
            - name: setup
              image: busybox:stable
              command:
                - /bin/chroot
                - /host
                - /bin/bash
                - -c
                - |-
                  set -uexo pipefail
                  ip addr replace "${FLOATING_IP}" dev eth0
              securityContext:
                privileged: true
              volumeMounts:
                - name: host
                  mountPath: /host
          hostNetwork: true
          restartPolicy: OnFailure
          volumes:
            - name: host
              hostPath:
                type: Directory
                path: /
    teardownJob:
      ttlSecondsAfterFinished: 3600
      template:
        spec:
          containers:
            - name: teardown
              image: busybox:stable
              command:
                - /bin/chroot
                - /host
                - /bin/bash
                - -c
                - |-
                  set -uexo pipefail
                  ip addr del "${FLOATING_IP}"/32 dev eth0 || true
              securityContext:
                privileged: true
              volumeMounts:
                - name: host
                  mountPath: /host
          hostNetwork: true
          restartPolicy: OnFailure
          volumes:
            - name: host
              hostPath:
                type: Directory
                path: /
  hcloud:
    # Default way to provide token is to use the well known Secret location
    # But you can also specify the token directly, if you wish.
    # token: hunter2
    # see: https://pkg.go.dev/github.com/hetznercloud/hcloud-go/hcloud?#ClientOption
    # pollInterval: 500 # milliseconds
    # endpoint: https://api.hetzner.cloud/v1
     applicationName: hcloud-fip-k8s
     applicationVersion: "{{ .Chart.Version }}"
  health:
    healthProbeBindAddress: :8081
  metrics:
    bindAddress: 127.0.0.1:8080
  leaderElection:
    leaderElect: {{ gt .Values.replicas 1 }}
    resourceName: "{{ include "hcloud-fip-k8s.fullname" . }}"
    resourceNamespace: "{{ .Release.Namespace }}"
    leaseDuration: 15
    renewDeadline: 10
    retryPeriod: 2
